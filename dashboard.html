<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Scoring Dashboard | Rainmaker</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root { --bg: #1C2C26; --card: #233d34; --border: #375c4e; --text: #f5f5f1; --dim: #98C1D3; --accent: #E5FF42; --green: #E5FF42; --red: #f87171; --yellow: #C8A96E; --orange: #C8A96E; --mist: #98C1D3; --sage: #716d6a; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: 300; background: var(--bg); color: var(--text); padding: 24px; max-width: 1200px; margin: 0 auto; letter-spacing: -0.01em; }
  h1 { font-family: 'DM Serif Display', Georgia, serif; font-size: 2rem; margin-bottom: 4px; letter-spacing: -0.02em; }
  .subtitle { color: var(--mist); font-size: 0.85rem; margin-bottom: 24px; font-weight: 300; }
  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 16px; margin-bottom: 24px; }
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
  .card h2 { font-family: 'DM Serif Display', Georgia, serif; font-size: 1.15rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; letter-spacing: -0.01em; }
  .badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 999px; font-weight: 600; text-transform: uppercase; }
  .badge-positive { background: rgba(229,255,66,0.15); color: var(--green); }
  .badge-mixed, .badge-neutral { background: rgba(200,169,110,0.15); color: var(--yellow); }
  .badge-negative { background: rgba(248,113,113,0.15); color: var(--red); }
  .stat-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); }
  .stat-row:last-child { border-bottom: none; }
  .stat-label { color: var(--mist); font-size: 0.85rem; font-weight: 300; }
  .stat-value { font-weight: 500; font-size: 0.95rem; }
  .post { padding: 14px 0; border-bottom: 1px solid var(--border); }
  .post:last-child { border-bottom: none; }
  .post-meta { display: flex; gap: 8px; align-items: center; margin-bottom: 6px; font-size: 0.8rem; color: var(--dim); flex-wrap: wrap; }
  .post-text { font-size: 0.9rem; line-height: 1.45; margin-bottom: 8px; }
  .post-stats { display: flex; gap: 16px; font-size: 0.8rem; color: var(--dim); }
  .post-stats span { display: flex; align-items: center; gap: 3px; }
  .risk-tag { background: rgba(248,113,113,0.15); color: var(--red); font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; font-weight: 600; }
  .pinned-tag { background: rgba(229,255,66,0.15); color: var(--accent); font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; }
  .repost-tag { background: rgba(218,186,137,0.15); color: var(--yellow); font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; }
  .topics { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
  .topic { background: var(--border); color: var(--dim); font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; }
  .risk-section { margin-top: 8px; }
  .risk-item { padding: 6px 0; font-size: 0.85rem; color: #daba89; }
  .risk-item::before { content: "‚ö† "; }
  .full-width { grid-column: 1 / -1; }
  .score-circle { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem; margin-right: 8px; flex-shrink: 0; }
  .score-row { display: flex; align-items: center; margin-bottom: 12px; }
  .score-row .details { font-size: 0.85rem; }
  .score-row .details .name { font-weight: 600; }
  .score-row .details .handle { color: var(--mist); }
  .notable { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 4px; }
  .notable-chip { background: rgba(229,255,66,0.12); color: var(--accent); font-size: 0.8rem; padding: 4px 10px; border-radius: 6px; font-weight: 400; }
  .section-card { margin-bottom: 24px; }
</style>
</head>
<body>

<div style="display:flex;align-items:center;gap:12px;margin-bottom:2px">
  <div style="font-family:'DM Serif Display',Georgia,serif;font-size:1.1rem;color:var(--accent);letter-spacing:0.08em;text-transform:uppercase;font-weight:400">Rainmaker</div>
  <div style="width:1px;height:20px;background:var(--border)"></div>
  <div style="font-size:0.8rem;color:var(--mist);text-transform:uppercase;letter-spacing:0.1em;font-weight:400">Social Intelligence</div>
</div>
<h1>Scoring Dashboard</h1>
<div class="subtitle" id="pull-time"></div>

<div class="grid" id="accounts"></div>

<div class="grid">
  <div class="card section-card">
    <h2>üìä Aggregate Metrics</h2>
    <div id="aggregate"></div>
  </div>
  <div class="card section-card">
    <h2>üë• Notable Followers</h2>
    <div class="notable" id="notable"></div>
    <div style="margin-top:12px">
      <h2>‚ö†Ô∏è Risk Signals</h2>
      <div class="risk-section" id="risks"></div>
    </div>
  </div>
</div>

<div class="card full-width section-card">
  <h2>üìù Recent Posts <span style="font-size:0.75rem;color:var(--dim);font-weight:400;margin-left:8px">sorted by views</span></h2>
  <div id="posts"></div>
</div>

<script>
const DATA_URL = 'initial-pull.json';

function fmt(n) {
  if (n >= 1e6) return (n/1e6).toFixed(1) + 'M';
  if (n >= 1e3) return (n/1e3).toFixed(1) + 'K';
  return n.toString();
}

function sentimentBadge(s) {
  if (!s) return '';
  const cls = s === 'positive' ? 'badge-positive' : s === 'negative' ? 'badge-negative' : 'badge-mixed';
  return `<span class="badge ${cls}">${s}</span>`;
}

function scoreColor(n) {
  if (n >= 7) return '#e5ff42';
  if (n >= 5) return '#daba89';
  return '#f87171';
}

async function init() {
  const res = await fetch(DATA_URL);
  const d = await res.json();

  const ts = d.pullTimestamp || d.pulled_at;
  document.getElementById('pull-time').textContent = `Data pulled: ${new Date(ts).toLocaleString()}`;

  // Account cards
  const accts = document.getElementById('accounts');
  for (const [key, a] of Object.entries(d.accounts)) {
    const score = a.sentiment_score || (a.sentiment === 'positive' ? 7 : a.sentiment === 'mixed' ? 6 : 5);
    const color = scoreColor(score);
    const name = a.name || a.handle;
    const roleTag = a.role ? `<span style="color:var(--accent);font-size:0.75rem"> (${a.role})</span>` : '';
    accts.innerHTML += `
      <div class="card">
        <div class="score-row">
          <div class="score-circle" style="border: 3px solid ${color}; color: ${color}">${score}</div>
          <div class="details">
            <div class="name">${name}${roleTag}</div>
            <div class="handle">${a.handle} ${a.verified ? '‚úì' : ''} ${sentimentBadge(a.sentiment)}</div>
          </div>
        </div>
        <div class="stat-row"><span class="stat-label">Followers</span><span class="stat-value">${fmt(a.followers)}</span></div>
        ${a.following ? `<div class="stat-row"><span class="stat-label">Following</span><span class="stat-value">${fmt(a.following)}</span></div>` : ''}
        <div class="stat-row"><span class="stat-label">Posts</span><span class="stat-value">${fmt(a.posts)}</span></div>
        ${a.location ? `<div class="stat-row"><span class="stat-label">Location</span><span class="stat-value">${a.location}</span></div>` : ''}
        ${a.joined ? `<div class="stat-row"><span class="stat-label">Joined</span><span class="stat-value">${a.joined}</span></div>` : ''}
        <div style="font-size:0.85rem;color:var(--dim);margin-top:8px;font-style:italic">"${a.bio}"</div>
      </div>`;
  }

  // Aggregate
  const ag = d.aggregateMetrics;
  const re = ag.recentEngagement || {};
  let agHtml = `
    <div class="stat-row"><span class="stat-label">Combined Followers</span><span class="stat-value">${fmt(ag.totalFollowers)}</span></div>`;
  if (ag.ceoToCorpFollowerRatio) agHtml += `<div class="stat-row"><span class="stat-label">CEO:Corp Follower Ratio</span><span class="stat-value">${ag.ceoToCorpFollowerRatio}x</span></div>`;
  if (ag.avgEngagementCorp) agHtml += `<div class="stat-row"><span class="stat-label">Avg Engagement (Corp)</span><span class="stat-value">${fmt(ag.avgEngagementCorp)}</span></div>`;
  if (ag.avgEngagementCeo) agHtml += `<div class="stat-row"><span class="stat-label">Avg Engagement (CEO)</span><span class="stat-value">${fmt(ag.avgEngagementCeo)}</span></div>`;
  if (re.totalViews) agHtml += `<div class="stat-row"><span class="stat-label">Recent Total Views</span><span class="stat-value">${fmt(re.totalViews)}</span></div>`;
  if (re.totalLikes) agHtml += `<div class="stat-row"><span class="stat-label">Recent Total Likes</span><span class="stat-value">${fmt(re.totalLikes)}</span></div>`;
  if (d.keyTopics) agHtml += `<div class="stat-row"><span class="stat-label">Key Topics</span><span class="stat-value" style="text-align:right;max-width:60%">${d.keyTopics.join(', ')}</span></div>`;
  document.getElementById('aggregate').innerHTML = agHtml;

  // Notable followers
  const notable = document.getElementById('notable');
  (d.notableFollowers || []).forEach(f => {
    notable.innerHTML += `<span class="notable-chip">${f}</span>`;
  });

  // Risks
  const risks = document.getElementById('risks');
  (d.riskSignals || []).forEach(r => {
    risks.innerHTML += `<div class="risk-item">${r}</div>`;
  });

  // Posts ‚Äî sorted by views desc
  const posts = document.getElementById('posts');
  const sortedPosts = [...(d.recentPosts || [])].sort((a, b) => (b.metrics?.views || 0) - (a.metrics?.views || 0));
  sortedPosts.forEach(p => {
    const m = p.metrics || {};
    const tags = [];
    if (p.isPinned) tags.push('<span class="pinned-tag">üìå PINNED</span>');
    if (p.risk_flag) tags.push('<span class="risk-tag">üö® RISK</span>');
    if (p.type === 'repost') tags.push(`<span class="repost-tag">üîÅ RT ${p.originalAuthor || ''}</span>`);
    const text = p.content || p.text || '';
    const topicsHtml = (p.topics || []).map(t => `<span class="topic">${t}</span>`).join('');
    posts.innerHTML += `
      <div class="post">
        <div class="post-meta">
          <strong>${p.account}</strong> ¬∑ ${p.date} ${tags.join(' ')} ${sentimentBadge(p.sentiment)}
        </div>
        <div class="post-text">${text}</div>
        <div class="post-stats">
          <span>üí¨ ${fmt(m.replies || 0)}</span>
          <span>üîÅ ${fmt(m.reposts || 0)}</span>
          <span>‚ù§Ô∏è ${fmt(m.likes || 0)}</span>
          <span>üëÅ ${fmt(m.views || 0)}</span>
        </div>
        ${topicsHtml ? `<div class="topics">${topicsHtml}</div>` : ''}
      </div>`;
  });
}

init();
</script>
<div style="text-align:center;color:var(--dim);font-size:0.75rem;padding:24px 0 12px;border-top:1px solid var(--border);margin-top:32px;">
  <span style="letter-spacing:0.05em;text-transform:uppercase">Rainmaker</span> ¬∑ Social Scoring ¬∑ Data refreshes daily at 6 AM CT ¬∑ <span id="footer-ts"></span>
</div>
<script>
fetch('initial-pull.json?t='+Date.now()).then(r=>r.json()).then(d=>{
  const el=document.getElementById('footer-ts');
  if(d.pulled_at) el.textContent='Last updated: '+new Date(d.pulled_at).toLocaleString();
}).catch(()=>{});
</script>
</body>
</html>
